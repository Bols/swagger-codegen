{{#models}}
{{#model}}
{{>partial_header}}


#' {{classname}} Class
#' @export
{{classname}} <- R6::R6Class(
  '{{classname}}',
  public = list(
    {{#vars}}
    {{{name}}} = NULL,
    {{/vars}}
    initialize = function({{#vars}}{{name}}{{#hasMore}}, {{/hasMore}}{{/vars}}){
      {{#vars}}
      if (!missing({{name}})) {
        {{^isListContainer}}
        {{#isInteger}}
        stopifnot(is.numeric({{name}}), length({{name}}) == 1)
        {{/isInteger}}
        {{#isLong}}
        stopifnot(is.numeric({{name}}), length({{name}}) == 1)
        {{/isLong}}
        {{#isFloat}}
        stopifnot(is.numeric({{name}}), length({{name}}) == 1)
        {{/isFloat}}
        {{#isDouble}}
        stopifnot(is.numeric({{name}}), length({{name}}) == 1)
        {{/isDouble}}
        {{#isString}}
        stopifnot(is.character({{name}}), length({{name}}) == 1)
        {{/isString}}
        {{#isDate}}
        stopifnot(is.character({{name}}), length({{name}}) == 1)
        {{/isDate}}
        {{#isDateTime}}
        stopifnot(is.character({{name}}), length({{name}}) == 1)
        {{/isDateTime}}
        {{^isPrimitiveType}}
        stopifnot(is.list(tags), length(tags) != 0)
        lapply({{name}}, function(x) stopifnot("Element" %in% class(x), !is.list(x)))
        {{/isPrimitiveType}}
        {{/isListContainer}}
        {{#isListContainer}}
        {{#isPrimitiveType}}
        stopifnot(is.list({{name}}), length({{name}}) != 0)
        lapply({{name}}, function(x) stopifnot(is.character(x)))
        {{/isPrimitiveType}}
        {{^isPrimitiveType}}
        stopifnot(is.list(tags), length(tags) != 0)
        lapply({{name}}, function(x) stopifnot("Element" %in% class(x), !is.list(x)))
        {{/isPrimitiveType}}
        {{/isListContainer}}
        self${{name}} <- {{name}}
      }
      {{/vars}}
    },
    toJSON = function() {
       sprintf(
        '{
           {{#vars}}
           "{{baseName}}": {{#isListContainer}}[{{/isListContainer}}{{#isPrimitiveType}}{{#isNumeric}}%d{{/isNumeric}}{{^isNumeric}}"%s"{{/isNumeric}}{{/isPrimitiveType}}{{^isPrimitiveType}}%s{{/isPrimitiveType}}{{#isListContainer}}]{{/isListContainer}}{{#hasMore}},{{/hasMore}}
           {{/vars}}
        }',
        {{#vars}}
        {{#isListContainer}}
        {{#isPrimitiveType}}
        lapply(self${{name}}, function(x) paste(paste0('"', x, '"'), sep=",")){{#hasMore}},{{/hasMore}}
        {{/isPrimitiveType}}
        {{^isPrimitiveType}}
        lapply(self${{name}}, function(x) paste(x$toJSON(), sep=",")){{#hasMore}},{{/hasMore}}
        {{/isPrimitiveType}}
        {{/isListContainer}}
        {{^isListContainer}}
        self${{name}}{{^isPrimitiveType}}$toJSON(){{/isPrimitiveType}}{{#hasMore}},{{/hasMore}}
        {{/isListContainer}}
        {{/vars}}
      )
    },
    fromJSON = function({{classname}}Json) {
      {{classname}}Object <- jsonlite::fromJSON({{classname}}Json)
      {{#vars}}
      {{#isPrimitiveType}}
      self${{name}} <- {{classname}}Object${{name}}
      {{/isPrimitiveType}}
      {{^isPrimitiveType}}
      {{#isListContainer}}
      self${{name}} <- lapply({{classname}}Object${{name}}, function(x) {{datatype}}$new()$fromJSON(x)
      {{/isListContainer}}
      {{^isListContainer}}
      self${{name}} <- {{datatype}}$new()$fromJSON({{classname}}Object${{name}})
      {{/isListContainer}}
      {{/isPrimitiveType}}
      {{/vars}}
    }
  )
)

#' Element Class
#'
#' Element Class
#' @export
Element  <- R6::R6Class(
  'Element',
  public = list(
    id = NULL,
    name = NULL,
    initialize = function(id,name){
      if (!missing(id)) {
        stopifnot(is.numeric(id), length(id) == 1)
        self$id <- id
      }
      if (!missing(name)) {
        stopifnot(is.character(name), length(name) == 1)
        self$name <- name
      }
    },
    toJSON = function() {
       sprintf('{"id":%d,"name":"%s"}', self$id, self$name)
    }
  )
)

#' Response Class
#'
#' Response Class
#' @export
Response  <- R6::R6Class(
  'Response',
  public = list(
    content = NULL,
    response = NULL,
    initialize = function(content, response){
      self$content <- content
      self$response <- response
    }
  )
)
{{/model}}
{{/models}}
